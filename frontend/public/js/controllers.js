var mp4Controllers=angular.module("mp4Controllers",["720kb.datepicker","ngResource","ngDialog"]),NEW_REQUEST=0,IN_PROGRESS=1,COMPLETED=3,DECLINED=2,homeurl="http://localhost:8080";mp4Controllers.controller("HomeCtrl",["$scope","$http","$resource","ngDialog",function($scope,$http,$resource,ngDialog){}]).controller("PortfolioCtrl",["$scope","$http","service","user","$routeParams","ngDialog",function($scope,$http,service,user,$routeParams,ngDialog){user.get($routeParams.id).success(function(data,status,headers,config){$scope.user=data.data,console.log($scope.user),$scope.services=$scope.user.services,angular.forEach($scope.services,function(i,key){service.get(i).then(function(res){var serv=res.data.data;console.log(serv),$scope.services.push(serv),console.log($scope.services)})},$scope.services)}).error(function(data,status,headers,config){console.log(data)})}]).controller("EditPortfolioCtrl",["$scope","$http","$resource","$routeParams","user","$route",function($scope,$http,$resource,$routeParams,user,$route){user.get($routeParams.id).then(function(data){$scope.user=data.data.data,console.log($scope.user),$scope.businessName=$scope.user.businessName,$scope.intro=$scope.user.intro,$scope.email=$scope.user.local.email}),$scope.updateUsername=function(data){sendData={username:data},user.update($routeParams.id,sendData,function(data){$route.reload()})},$scope.updateIntro=function(data){sendData={intro:data},user.update($routeParams.id,sendData,function(data){$route.reload()})},$scope.updateBusinessName=function(data){sendData={businessName:data},user.update($routeParams.id,sendData,function(data){$route.reload()})},$scope.updateEmail=function(data){sendData={local:{email:data,password:$scope.user.local.password}},user.update($routeParams.id,sendData,function(data){$route.reload()})}}]).controller("QueueCtrl",["$scope","$http","request","$routeParams","user","ngDialog","$location",function($scope,$http,request,$routeParams,user,ngDialog,$location){$scope.curType=NEW_REQUEST,$scope.sortBy="+";var SPID=$routeParams.id,reqids=[];[].slice.call(document.querySelectorAll(".tabs")).forEach(function(el){new CBPFWTabs(el)}),$scope.setType=function(type){$scope.curType=type,$scope.reload(),console.log("query for type: "+$scope.curType)},$scope.reload=function(){console.log("reload"),$scope.SP,user.get(SPID).then(function(res){console.log("got data"),$scope.SP=res.data.data,console.log($scope.SP),console.log("get req type: "+$scope.curType),$scope.curType==NEW_REQUEST?reqids=$scope.SP["new"]:$scope.curType==IN_PROGRESS?reqids=$scope.SP.accepted:$scope.curType==DECLINED?reqids=$scope.SP.rejected:$scope.curType==COMPLETED&&(reqids=$scope.SP.completed),console.log(reqids),$scope.tasks=[],angular.forEach(reqids,function(i,key){request.get(i).then(function(res){var req=res.data.data;console.log(req),$scope.tasks.push(req)})},$scope.tasks)})},$scope.seeDetail=function(i){var ID=$scope.tasks[i]._id;console.log("id is: "+ID),$scope.req=$scope.tasks[i],$scope.curAccept=$scope.req.acceptedTime,$scope.dialog=ngDialog.open({template:"./partials/requestDetail.html",className:"ngdialog-theme-default request-dialog-width",controller:"DetailCtrl",scope:$scope})},$scope.showAddService=function(){console.log("add service modal"),$scope.dialog=ngDialog.open({template:"./partials/newService.html",className:"ngdialog-theme-default request-dialog-width",controller:"AddServiceCtrl",scope:$scope})},$scope.reload()}]).controller("AddServiceCtrl",["$scope","$http","service","$routeParams","user",function($scope,$http,service,$routeParams,user){var SPID=$routeParams.id;$scope.newService={userID:SPID,availability:"",serviceName:"",description:""},$scope.addService=function(){console.log("adding service"),console.log($scope.newService),service.post(SPID,$scope.newService,function(res){console.log(res),$scope.dialog.close()})}}]).controller("DetailCtrl",["$scope","$http","request","$routeParams","user",function($scope,$http,request,$routeParams,user){$scope.acceptTime=function(i){$scope.curType==NEW_REQUEST&&($scope.curAccept[i]?$scope.curAccept[i]&&(angular.element(document.querySelector("#slot_"+i)).removeClass("selected"),$scope.curAccept[i]=!1):(angular.element(document.querySelector("#slot_"+i)).addClass("selected"),$scope.curAccept[i]=!0),console.log($scope.curAccept))},$scope.accept=function(){$scope.curType==NEW_REQUEST&&($scope.req.acceptedTime=$scope.curAccept,console.log("curAccept: "),console.log($scope.curAccept),$scope.req.status=IN_PROGRESS,console.log("update request"),console.log($scope.req),request.update($scope.req._id,$scope.req,function(data){console.log(data),$scope.reload(),$scope.dialog.close()}))},$scope.decline=function(){$scope.req.status=DECLINED,console.log("update request"),console.log($scope.req),request.update($scope.req._id,$scope.req,function(data){console.log(data),$scope.reload(),$scope.dialog.close()})},$scope.complete=function(){$scope.req.status=COMPLETED,console.log("update request"),console.log($scope.req),request.update($scope.req._id,$scope.req,function(data){console.log(data),$scope.reload(),$scope.dialog.close()})},$scope.showAcceptedTime=function(){}}]).controller("NewRequestCtrl",["$scope","$http","$routeParams","SP","request","user","$compile",function($scope,$http,$routeParams,SP,request,user,$compile){var SPID=$routeParams.id;$scope.SP,$scope.newRequest={creatorID:"",userID:SPID,message:"",service:"",customerName:"",contactInfo:"",status:NEW_REQUEST,proposedTime:[],acceptedTime:[],createdTime:Date.now()},$scope.reload=function(){console.log("reload"),user.get(SPID).then(function(res){console.log("got data"),$scope.SP=res.data.data,console.log($scope.SP)})},$scope.sendRequest=function(){console.log("sending request"),console.log($scope.newRequest),request.post(SPID,$scope.newRequest,function(data){console.log("sent request"),console.log(data)})},$scope.newInputField=function(i){var myEl=angular.element(document.querySelector("#input_"+i));if(myEl.attr("readonly"),console.log("input: "+i),myEl.attr("readonly")){var j=i+1;myEl.attr("readonly",!1);var newInput='<div class="row" id="inputdiv_'+j+'"><input id="input_'+j+'" ng-click="newInputField('+j+')" readonly="true"></div>',content=$compile(newInput)($scope);angular.element(document.querySelector("#inputdiv_"+i)).after(content)}};var that=this,in10Days=new Date;in10Days.setDate(in10Days.getDate()+10),this.dates={date1:new Date("2015-03-01T00:00:00Z"),date2:new Date("2015-03-01T12:30:00Z"),date3:new Date,date4:new Date,date5:in10Days,date6:new Date,date7:new Date,date8:new Date,date9:null,date10:new Date("2015-03-01T09:00:00Z"),date11:new Date("2015-03-01T10:00:00Z")},this.open={date1:!1,date2:!1,date3:!1,date4:!1,date5:!1,date6:!1,date7:!1,date8:!1,date9:!1,date10:!1,date11:!1},this.disabled=function(date,mode){return"day"===mode&&(new Date).toDateString()==date.toDateString()},this.dateOptions={showWeeks:!1,startingDay:1},this.timeOptions={readonlyInput:!1,showMeridian:!1},this.dateModeOptions={minMode:"year",maxMode:"year"},this.openCalendar=function(e,date){that.open[date]=!0};var unwatch=$scope.$watch(function(){return that.dates},function(){if(that.dates.date4&&that.dates.date5){var diff=that.dates.date4.getTime()-that.dates.date5.getTime();that.dayRange=Math.round(Math.abs(diff/864e5))}else that.dayRange="n/a"},!0);$scope.$on("$destroy",function(){unwatch()}),$scope.reload()}]).controller("loginCtrl",["$scope","$http","$resource","SP","user","$location",function($scope,$http,$resource,SP,user,$location){$scope.password,$scope.email,$scope.login=function(){$http({method:"POST",url:homeurl+"/login",data:$.param({email:$scope.email,password:$scope.password}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data,status,headers,config){console.log($scope.setUser(data.data)),$scope.dialog.close(),$location.path("/user/"+data.data._id)}).error(function(data,status,headers,config){console.log("data: "+data),console.log("status: "+status),console.log("headers: "+headers),$scope.dialog.close()})}}]).controller("signUpCtrl",["$scope","$http","$resource","SP","user","$location",function($scope,$http,$resource,SP,user,$location){$scope.password,$scope.email,$scope.username,$scope.businessName,$scope.signup=function(){$http({method:"POST",url:homeurl+"/signup",data:$.param({email:$scope.email,password:$scope.password,username:$scope.username,businessName:$scope.businessName}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data,status,headers,config){console.log(data.data._id),$scope.dialog.close(),$location.path("/user/"+data.data._id)}).error(function(data,status,headers,config){console.log("data: "+data),console.log("status: "+status),console.log("headers: "+headers),$scope.dialog.close()})}}]).controller("TopbarCtrl",["$scope","$http","$resource","ngDialog","SP","$location",function($scope,$http,$resource,ngDialog,SP,$location){$scope.curUser=null,$scope.showLogin=function(){$scope.dialog=ngDialog.open({template:"./partials/login.html",className:"ngdialog-theme-default",controller:"loginCtrl",scope:$scope})},$scope.showSignup=function(){$scope.dialog=ngDialog.open({template:"./partials/signup.html",className:"ngdialog-theme-default",controller:"signUpCtrl",scope:$scope})},$scope.viewMyQueue=function(){var url="/user/";$scope.curUser?(console.log(url+$scope.curUser._id),$location.path(url+$scope.curUser._id)):$scope.showLogin()},$scope.logout=function(){$http({method:"GET",url:homeurl+"/logout",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data,status,headers,config){console.log("logged out"),$scope.curUser=null}).error(function(data,status,headers,config){console.log("data: "+data),console.log("status: "+status),console.log("headers: "+headers)})},$scope.setUser=function(newval){$scope.curUser=newval,console.log("showLogout: "),console.log($scope.curUser)},$scope.showLogout=function(){return null==$scope.curUser?!1:!0},$scope.$watch("curUser",function(){$scope.showLogout()}),$scope.getCurUser=function(){console.log("try get logged in user"),$http({method:"GET",url:homeurl+"/user",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data,status,headers,config){console.log("got logged in user"),console.log(data.data),$scope.curUser=data.data}).error(function(data,status,headers,config){console.log("get user error"),console.log("data: "+data),console.log("status: "+status),console.log("headers: "+headers)})},$scope.getCurUser()}]).controller("profileController",["$scope","$http",function($scope,$http){$scope.profile=!1,$http.get("/profile").success(function(data){console.log(data),data.error||($scope.profile=!0,$scope.user=data.user)})}]).directive("topbar",function(){return{template:'\n    <div class="small-12 fixtop navbar" ng-controller = "TopbarCtrl">\n              <div class="small-12 small-centered columns">\n            <div class="float-left small-6 large-4 columns">\n                <div class="row">\n                    <div class="columns small-4"><a href="#/" class="bt round">Service</a></div>\n                    <div ng-show="showLogout()" id="MyQueueBt" class="columns small-8 end" ng-click="viewMyQueue()"><a class="bt round">My Queue</a></div>\n                </div>\n            </div>\n            <div class="float-right small-6 large-4 columns">\n                <div class="float-right row" id="SignUpLoginBt" ng-hide="showLogout()">\n                    <div class="columns small-6 float-right" ng-click="showSignup()"><a  class="bt round float-right">Signup</a></div>\n                    <div class="columns small-4 end float-right" ng-click="showLogin()"><a class="bt round float-right">Login</a></div>\n                </div>\n                <div class="float-right row" id="LogoutBt" ng-show="showLogout()">\n                    <div class="column small-6 float-right centertext align-self-middle">\n                        <a ng-href="#/user/portfolio/{{curUser._id}}">Hi, {{curUser.username}}</a>\n                    </div>\n                    <div class="columns small-4 end float-right" ng-click="logout()">\n                        <a class="bt round float-right">Logout</a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>'}});