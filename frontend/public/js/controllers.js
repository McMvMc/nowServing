var mp4Controllers=angular.module("mp4Controllers",["720kb.datepicker","ngResource","ngDialog"]),NEW_REQUEST=0,IN_PROGRESS=1,COMPLETED=3,DECLINED=2,homeurl="http://locationhost:8080";mp4Controllers.controller("HomeCtrl",["$scope","$http","$resource","ngDialog",function($scope,$http,$resource,ngDialog){}]).controller("PortfolioCtrl",["$scope","$http","$resource",function($scope,$http,$resource){}]).controller("EditPortfolioCtrl",["$scope","$http","$resource",function($scope,$http,$resource){}]).controller("QueueCtrl",["$scope","$http","request","$routeParams","user","ngDialog","$location",function($scope,$http,request,$routeParams,user,ngDialog,$location){$scope.curType=NEW_REQUEST,$scope.sortBy="+";var SPID=$routeParams.id,reqids=[];[].slice.call(document.querySelectorAll(".tabs")).forEach(function(el){new CBPFWTabs(el)}),$scope.setType=function(type){$scope.curType=type,$scope.reload(),console.log("query for type: "+$scope.curType)},$scope.reload=function(){console.log("reload"),$scope.SP,user.get(SPID).then(function(res){console.log("got data"),$scope.SP=res.data.data,console.log($scope.SP),console.log("get req type: "+$scope.curType),$scope.curType==NEW_REQUEST?reqids=$scope.SP["new"]:$scope.curType==IN_PROGRESS?reqids=$scope.SP.accepted:$scope.curType==DECLINED?reqids=$scope.SP.rejected:$scope.curType==COMPLETED&&(reqids=$scope.SP.completed),console.log(reqids),$scope.tasks=[],angular.forEach(reqids,function(i,key){request.get(i).then(function(res){var req=res.data.data;console.log(req),$scope.tasks.push(req)})},$scope.tasks)})},$scope.seeDetail=function(i){var ID=$scope.tasks[i]._id;console.log("id is: "+ID),$scope.req=$scope.tasks[i],$scope.curAccept=$scope.req.acceptedTime,$scope.dialog=ngDialog.open({template:"./partials/requestDetail.html",className:"ngdialog-theme-default request-dialog-width",controller:"DetailCtrl",scope:$scope})},$scope.addService=function(){$location.path(homeurl+"/newservice/"+SPID)},$scope.reload()}]).controller("DetailCtrl",["$scope","$http","request","$routeParams","user",function($scope,$http,request,$routeParams,user){$scope.acceptTime=function(i){$scope.curType==NEW_REQUEST&&($scope.curAccept[i]?$scope.curAccept[i]&&(angular.element(document.querySelector("#slot_"+i)).removeClass("selected"),$scope.curAccept[i]=!1):(angular.element(document.querySelector("#slot_"+i)).addClass("selected"),$scope.curAccept[i]=!0),console.log($scope.curAccept))},$scope.accept=function(){$scope.curType==NEW_REQUEST&&($scope.req.acceptedTime=$scope.curAccept,console.log("curAccept: "),console.log($scope.curAccept),$scope.req.status=IN_PROGRESS,console.log("update request"),console.log($scope.req),request.update($scope.req._id,$scope.req,function(data){console.log(data),$scope.reload(),$scope.dialog.close()}))},$scope.decline=function(){$scope.req.status=DECLINED,console.log("update request"),console.log($scope.req),request.update($scope.req._id,$scope.req,function(data){console.log(data),$scope.reload(),$scope.dialog.close()})},$scope.complete=function(){$scope.req.status=COMPLETED,console.log("update request"),console.log($scope.req),request.update($scope.req._id,$scope.req,function(data){console.log(data),$scope.reload(),$scope.dialog.close()})},$scope.showAcceptedTime=function(){}}]).controller("NewRequestCtrl",["$scope","$http","$routeParams","SP","request","user",function($scope,$http,$routeParams,SP,request,user){var SPID=$routeParams.id;$scope.SP,$scope.newRequest={creatorID:"",userID:SPID,message:"",service:"",customerName:"",contactInfo:"",status:NEW_REQUEST,proposedTime:[],acceptedTime:[],createdTime:Date.now()},$scope.reload=function(){console.log("reload"),user.get(SPID).then(function(res){console.log("got data"),$scope.SP=res.data.data,console.log($scope.SP)})},$scope.sendRequest=function(){console.log("sending request"),console.log($scope.newRequest),request.post(SPID,$scope.newRequest,function(data){console.log("sent request"),console.log(data)})},$scope.reload()}]).controller("loginCtrl",["$scope","$http","$resource","SP","user","$location",function($scope,$http,$resource,SP,user,$location){$scope.password,$scope.email,$scope.login=function(){$http({method:"POST",url:"http://localhost:8080/login",data:$.param({email:$scope.email,password:$scope.password}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data,status,headers,config){console.log(data.data._id),SP.set(data.data),$location.path("/serviceprovider/"+data.data._id)}).error(function(data,status,headers,config){})}}]).controller("TopbarCtrl",["$scope","$http","$resource","ngDialog","SP","$location",function($scope,$http,$resource,ngDialog,SP,$location){$scope.showLogin=function(){ngDialog.open({template:"./partials/login.html",className:"ngdialog-theme-default",controller:"loginCtrl"})},$scope.showSignup=function(){ngDialog.open({template:"./partials/signup.html",className:"ngdialog-theme-default",controller:"signUpCtrl"})},$scope.viewMyQueue=function(){var url="/serviceprovider/",curUser=SP.get();curUser?(console.log(url+curUser._id),$location.path(url+curUser._id)):$scope.showLogin()}}]).controller("profileController",["$scope","$http",function($scope,$http){$scope.profile=!1,$http.get("/profile").success(function(data){console.log(data),data.error||($scope.profile=!0,$scope.user=data.user)})}]).directive("topbar",function(){return{template:'\n    <div class="small-12 fixtop navbar" ng-controller = "TopbarCtrl">\n              <div class="small-12 small-centered columns">\n            <div class="float-left small-6 large-4 columns">\n                <div class="row">\n                    <div class="columns small-4"><a href="#/" class="bt round">Service</a></div>\n                    <div class="columns small-8 end" ng-click="viewMyQueue()"><a class="bt round">My Queue</a></div>\n                </div>\n            </div>\n            <div class="float-right small-6 large-4 columns">\n                <div class="float-right row">\n                    <div class="columns small-6 float-right" ng-click="showSignup()"><a  class="bt round float-right">Signup</a></div>\n                    <div class="columns small-4 end float-right" ng-click="showLogin()"><a class="bt round float-right">Login</a></div>\n                </div>\n\n            </div>\n        </div>\n    </div>'}});